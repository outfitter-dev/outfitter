{
  "version": "1.0.0",
  "blocks": {
    "claude": {
      "name": "claude",
      "description": "Claude Code settings and hooks for automated formatting",
      "files": [
        {
          "path": ".claude/settings.json",
          "content": "{\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"bash \\\"$CLAUDE_PROJECT_DIR/scripts/bootstrap.sh\\\"\",\n            \"timeout\": 120\n          }\n        ]\n      }\n    ],\n    \"Stop\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"bash \\\"$CLAUDE_PROJECT_DIR/.claude/hooks/format-code-on-stop.sh\\\"\",\n            \"timeout\": 60\n          }\n        ]\n      }\n    ]\n  },\n  \"enabledPlugins\": {},\n  \"extraKnownMarketplaces\": {}\n}\n"
        },
        {
          "path": ".claude/hooks/format-code-on-stop.sh",
          "content": "#!/usr/bin/env bash\n# format-code-on-stop.sh\n# Formats code and markdown files changed during the session.\n# Designed for Claude Code Stop hook - runs after agent completes work.\n\nset -euo pipefail\n\n# -----------------------------------------------------------------------------\n# Configuration\n# -----------------------------------------------------------------------------\n\n# File patterns for each formatter\nCODE_PATTERNS=\"*.js *.jsx *.ts *.tsx *.json *.jsonc *.css\"\nMARKDOWN_PATTERNS=\"*.md\"\n\n# -----------------------------------------------------------------------------\n# Helpers\n# -----------------------------------------------------------------------------\n\nlog() {\n  echo \"[format] $*\"\n}\n\nwarn() {\n  echo \"[format] WARNING: $*\" >&2\n}\n\nhint() {\n  echo \"[format] HINT: $*\" >&2\n}\n\n# Check if a command exists\nhas_cmd() {\n  command -v \"$1\" &>/dev/null\n}\n\n# Get changed files (staged + unstaged, excluding deleted)\nget_changed_files() {\n  local patterns=(\"$@\")\n  local files=()\n\n  # Get both staged and unstaged changes, excluding deleted files\n  for pattern in \"${patterns[@]}\"; do\n    while IFS= read -r file; do\n      [[ -n \"$file\" && -f \"$file\" ]] && files+=(\"$file\")\n    done < <(git diff --name-only --diff-filter=d HEAD -- \"$pattern\" 2>/dev/null || true)\n\n    # Also check untracked files matching pattern\n    while IFS= read -r file; do\n      [[ -n \"$file\" && -f \"$file\" ]] && files+=(\"$file\")\n    done < <(git ls-files --others --exclude-standard -- \"$pattern\" 2>/dev/null || true)\n  done\n\n  # Deduplicate\n  printf '%s\\n' \"${files[@]}\" | sort -u\n}\n\n# -----------------------------------------------------------------------------\n# Formatters\n# -----------------------------------------------------------------------------\n\nformat_code() {\n  local files=()\n\n  # Collect changed code files\n  while IFS= read -r file; do\n    [[ -n \"$file\" ]] && files+=(\"$file\")\n  done < <(get_changed_files $CODE_PATTERNS)\n\n  if [[ ${#files[@]} -eq 0 ]]; then\n    log \"No code files to format\"\n    return 0\n  fi\n\n  log \"Formatting ${#files[@]} code file(s)...\"\n\n  # Check for bun\n  if ! has_cmd bun; then\n    warn \"bun not found - skipping code formatting\"\n    hint \"Install bun: curl -fsSL https://bun.sh/install | bash\"\n    return 0\n  fi\n\n  # Check for ultracite (via bun x)\n  if ! bun x ultracite --version &>/dev/null; then\n    warn \"ultracite not available - skipping code formatting\"\n    hint \"Install ultracite: bun add -d ultracite\"\n    return 0\n  fi\n\n  # Run ultracite fix on changed files\n  if bun x ultracite fix \"${files[@]}\" 2>/dev/null; then\n    log \"Code formatting complete\"\n  else\n    warn \"ultracite encountered errors (non-fatal)\"\n  fi\n}\n\nformat_markdown() {\n  local files=()\n\n  # Collect changed markdown files\n  while IFS= read -r file; do\n    [[ -n \"$file\" ]] && files+=(\"$file\")\n  done < <(get_changed_files $MARKDOWN_PATTERNS)\n\n  if [[ ${#files[@]} -eq 0 ]]; then\n    log \"No markdown files to format\"\n    return 0\n  fi\n\n  log \"Formatting ${#files[@]} markdown file(s)...\"\n\n  # Check for markdownlint-cli2\n  if has_cmd markdownlint-cli2; then\n    if markdownlint-cli2 --fix \"${files[@]}\" 2>/dev/null; then\n      log \"Markdown formatting complete\"\n    else\n      warn \"markdownlint-cli2 encountered errors (non-fatal)\"\n    fi\n    return 0\n  fi\n\n  # Try via bunx/npx\n  if has_cmd bun && bun x markdownlint-cli2 --help &>/dev/null; then\n    if bun x markdownlint-cli2 --fix \"${files[@]}\" 2>/dev/null; then\n      log \"Markdown formatting complete\"\n    else\n      warn \"markdownlint-cli2 encountered errors (non-fatal)\"\n    fi\n    return 0\n  fi\n\n  if has_cmd npx && npx markdownlint-cli2 --help &>/dev/null; then\n    if npx markdownlint-cli2 --fix \"${files[@]}\" 2>/dev/null; then\n      log \"Markdown formatting complete\"\n    else\n      warn \"markdownlint-cli2 encountered errors (non-fatal)\"\n    fi\n    return 0\n  fi\n\n  warn \"markdownlint-cli2 not found - skipping markdown formatting\"\n  hint \"Install: bun add -g markdownlint-cli2  OR  npm install -g markdownlint-cli2\"\n}\n\n# -----------------------------------------------------------------------------\n# Main\n# -----------------------------------------------------------------------------\n\nmain() {\n  # Ensure we're in a git repo\n  if ! git rev-parse --is-inside-work-tree &>/dev/null; then\n    warn \"Not in a git repository - skipping formatting\"\n    exit 0\n  fi\n\n  # Change to repo root\n  cd \"$(git rev-parse --show-toplevel)\"\n\n  log \"Checking for files to format...\"\n\n  format_code\n  format_markdown\n\n  log \"Done\"\n}\n\nmain \"$@\"\n",
          "executable": true
        }
      ]
    },
    "biome": {
      "name": "biome",
      "description": "Biome linter/formatter configuration via Ultracite",
      "files": [
        {
          "path": "biome.json",
          "content": "{\n  \"$schema\": \"https://biomejs.dev/schemas/1.9.4/schema.json\",\n  \"root\": false,\n  \"javascript\": {\n    \"globals\": [\"Bun\"]\n  },\n  \"linter\": {\n    \"rules\": {\n      \"complexity\": {\n        \"useLiteralKeys\": \"off\",\n        \"noVoid\": \"off\",\n        \"noExcessiveCognitiveComplexity\": \"off\"\n      },\n      \"performance\": {\n        \"useTopLevelRegex\": \"off\"\n      },\n      \"style\": {\n        \"useBlockStatements\": \"off\"\n      },\n      \"suspicious\": {\n        \"noConsole\": \"error\"\n      }\n    }\n  },\n  \"vcs\": {\n    \"enabled\": true,\n    \"clientKind\": \"git\",\n    \"useIgnoreFile\": true\n  },\n  \"files\": {\n    \"ignoreUnknown\": true,\n    \"includes\": [\"!**/node_modules\", \"!**/dist\", \"!**/.turbo\", \"!**/*.gen.ts\"]\n  },\n  \"overrides\": [\n    {\n      \"includes\": [\"packages/*/src/index.ts\", \"apps/*/src/index.ts\", \"**/index.ts\"],\n      \"linter\": {\n        \"rules\": {\n          \"performance\": {\n            \"noBarrelFile\": \"off\"\n          }\n        }\n      }\n    },\n    {\n      \"includes\": [\"**/*.test.ts\", \"**/__tests__/**/*\"],\n      \"linter\": {\n        \"rules\": {\n          \"suspicious\": {\n            \"useAwait\": \"off\",\n            \"noConsole\": \"off\"\n          },\n          \"performance\": {\n            \"noDelete\": \"off\"\n          }\n        }\n      }\n    },\n    {\n      \"includes\": [\n        \"apps/**/*.ts\",\n        \"scripts/**/*.ts\",\n        \"**/scripts/**/*.ts\"\n      ],\n      \"linter\": {\n        \"rules\": {\n          \"suspicious\": {\n            \"noConsole\": \"off\"\n          }\n        }\n      }\n    }\n  ]\n}\n"
        }
      ],
      "devDependencies": {
        "ultracite": "^7.0.0"
      }
    },
    "lefthook": {
      "name": "lefthook",
      "description": "Git hooks via Lefthook for pre-commit and pre-push",
      "files": [
        {
          "path": ".lefthook.yml",
          "content": "# Lefthook configuration preset for Outfitter projects\n# https://github.com/evilmartians/lefthook\n#\n# Usage: In your project's .lefthook.yml, add:\n#   extends:\n#     - node_modules/@outfitter/tooling/lefthook.yml\n\npre-commit:\n  parallel: true\n  commands:\n    ultracite:\n      glob: \"*.{js,jsx,ts,tsx,json,jsonc,css}\"\n      run: bun x ultracite fix {staged_files}\n      stage_fixed: true\n\n    typecheck:\n      glob: \"*.{ts,tsx}\"\n      run: bun run typecheck\n\npre-push:\n  parallel: false\n  commands:\n    build:\n      run: bun run build\n\n    test:\n      # TDD Override: For RED phase support, override in your project's lefthook.yml:\n      #   pre-push:\n      #     commands:\n      #       test:\n      #         run: ./scripts/pre-push-test.sh  # allows *-tests branches with failing tests\n      run: bun run test\n"
        }
      ],
      "devDependencies": {
        "lefthook": "^2.0.0"
      }
    },
    "bootstrap": {
      "name": "bootstrap",
      "description": "Project bootstrap script for installing tools and dependencies",
      "files": [
        {
          "path": "scripts/bootstrap.sh",
          "content": "#!/usr/bin/env bash\n#\n# bootstrap.sh — Get this repo from clone to runnable\n#\n# Usage: ./scripts/bootstrap.sh [--force]\n#\n# By default, exits immediately if all tools and deps are present.\n# Use --force to run full bootstrap regardless.\n#\n\nset -euo pipefail\n\n# -----------------------------------------------------------------------------\n# Fast path — exit immediately if all tools and deps are present\n# -----------------------------------------------------------------------------\nif [[ \"${1:-}\" != \"--force\" ]]; then\n  all_present=true\n  command -v bun &>/dev/null || all_present=false\n  command -v gh &>/dev/null || all_present=false\n  command -v gt &>/dev/null || all_present=false\n  command -v markdownlint-cli2 &>/dev/null || all_present=false\n  [[ -d \"node_modules\" ]] || all_present=false\n\n  if $all_present; then\n    exit 0  # All good, nothing to do\n  fi\nfi\n\n# Strip --force if present\n[[ \"${1:-}\" == \"--force\" ]] && shift\n\n# Colors\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[0;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\ninfo() { echo -e \"${BLUE}▸${NC} $1\"; }\nsuccess() { echo -e \"${GREEN}✓${NC} $1\"; }\nwarn() { echo -e \"${YELLOW}!${NC} $1\"; }\nerror() { echo -e \"${RED}✗${NC} $1\" >&2; }\n\n# Check if command exists\nhas() { command -v \"$1\" &>/dev/null; }\n\n# Detect OS\nOS=\"$(uname -s)\"\ncase \"$OS\" in\n  Darwin) IS_MACOS=true ;;\n  Linux)  IS_MACOS=false ;;\n  *)      error \"Unsupported OS: $OS\"; exit 1 ;;\nesac\n\n# -----------------------------------------------------------------------------\n# Homebrew (macOS only)\n# -----------------------------------------------------------------------------\ninstall_homebrew() {\n  if $IS_MACOS && ! has brew; then\n    info \"Installing Homebrew...\"\n    /bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n    success \"Homebrew installed\"\n  fi\n}\n\n# -----------------------------------------------------------------------------\n# Bun\n# -----------------------------------------------------------------------------\ninstall_bun() {\n  if has bun; then\n    success \"Bun already installed ($(bun --version))\"\n  else\n    info \"Installing Bun...\"\n    curl -fsSL https://bun.sh/install | bash\n    # Source the updated profile\n    export BUN_INSTALL=\"$HOME/.bun\"\n    export PATH=\"$BUN_INSTALL/bin:$PATH\"\n    success \"Bun installed ($(bun --version))\"\n  fi\n}\n\n# -----------------------------------------------------------------------------\n# GitHub CLI (gh)\n# -----------------------------------------------------------------------------\ninstall_gh() {\n  if has gh; then\n    success \"GitHub CLI already installed ($(gh --version | head -1))\"\n  else\n    info \"Installing GitHub CLI...\"\n    if $IS_MACOS; then\n      brew install gh\n    else\n      # Linux: use official apt repo\n      curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg\n      echo \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main\" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null\n      sudo apt update && sudo apt install gh -y\n    fi\n    success \"GitHub CLI installed\"\n  fi\n}\n\n# -----------------------------------------------------------------------------\n# Graphite CLI (gt)\n# -----------------------------------------------------------------------------\ninstall_graphite() {\n  if has gt; then\n    success \"Graphite CLI already installed ($(gt --version 2>/dev/null || echo 'unknown'))\"\n  else\n    info \"Installing Graphite CLI...\"\n    if $IS_MACOS && has brew; then\n      brew install withgraphite/tap/graphite\n    else\n      bun install -g @withgraphite/graphite-cli\n    fi\n    success \"Graphite CLI installed\"\n  fi\n}\n\n# -----------------------------------------------------------------------------\n# markdownlint-cli2\n# -----------------------------------------------------------------------------\ninstall_markdownlint() {\n  if has markdownlint-cli2; then\n    success \"markdownlint-cli2 already installed\"\n  else\n    info \"Installing markdownlint-cli2...\"\n    bun install -g markdownlint-cli2\n    success \"markdownlint-cli2 installed\"\n  fi\n}\n\n# -----------------------------------------------------------------------------\n# Auth checks\n# -----------------------------------------------------------------------------\ncheck_auth() {\n  echo \"\"\n  info \"Checking authentication...\"\n\n  # GitHub CLI\n  if [[ -n \"${GH_TOKEN:-}\" ]] || [[ -n \"${GITHUB_TOKEN:-}\" ]]; then\n    success \"GitHub CLI token found in environment\"\n  elif gh auth status &>/dev/null; then\n    success \"GitHub CLI already authenticated\"\n  else\n    echo \"    GitHub CLI not authenticated. Run 'gh auth login' or set GH_TOKEN\"\n  fi\n\n  # Graphite CLI\n  if [[ -n \"${GT_AUTH_TOKEN:-}\" ]]; then\n    info \"Authenticating Graphite CLI...\"\n    gt auth --token \"$GT_AUTH_TOKEN\"\n    success \"Graphite CLI authenticated\"\n  elif gt auth status &>/dev/null 2>&1; then\n    success \"Graphite CLI already authenticated\"\n  else\n    echo \"    Graphite CLI not authenticated. Run 'gt auth' or set GT_AUTH_TOKEN\"\n  fi\n}\n\n# -----------------------------------------------------------------------------\n# Project dependencies\n# -----------------------------------------------------------------------------\ninstall_deps() {\n  info \"Installing project dependencies...\"\n  bun install\n  success \"Dependencies installed\"\n}\n\n# -----------------------------------------------------------------------------\n# Main\n# -----------------------------------------------------------------------------\nmain() {\n  echo \"\"\n  echo -e \"${BLUE}Outfitter Kit Bootstrap${NC}\"\n  echo \"────────────────────────\"\n  echo \"\"\n\n  # Prerequisites\n  if $IS_MACOS; then\n    install_homebrew\n  fi\n\n  # Core tools\n  install_bun\n  install_gh\n  install_graphite\n  install_markdownlint\n\n  # Auth status\n  check_auth\n\n  echo \"\"\n\n  # Project setup\n  install_deps\n\n  echo \"\"\n  echo -e \"${GREEN}Bootstrap complete!${NC}\"\n  echo \"\"\n  echo \"Next steps:\"\n  echo \"  bun run build      # Build all packages\"\n  echo \"  bun run test       # Run tests\"\n  echo \"\"\n}\n\nmain \"$@\"\n",
          "executable": true
        }
      ]
    },
    "scaffolding": {
      "name": "scaffolding",
      "description": "Full starter kit: Claude settings, Biome, Lefthook, and bootstrap script",
      "extends": [
        "claude",
        "biome",
        "lefthook",
        "bootstrap"
      ]
    }
  }
}
