import { describe, expect, test } from "bun:test";
import { createContext } from "@outfitter/contracts";
import { createGreeting } from "./handlers.js";

describe("createGreeting", () => {
	test("returns greeting for valid input", async () => {
		const ctx = createContext({
			cwd: process.cwd(),
			env: process.env,
		});
		const result = await createGreeting(
			{ name: "Outfitter", excited: true },
			ctx
		);

		expect(result.isOk()).toBe(true);
		if (result.isErr()) {
			return;
		}
		expect(result.value.message).toBe("Hello, Outfitter!");
	});

	test("returns validation error for invalid input", async () => {
		const ctx = createContext({
			cwd: process.cwd(),
			env: process.env,
		});
		const result = await createGreeting({ name: "" }, ctx);

		expect(result.isErr()).toBe(true);
		if (result.isErr()) {
			expect(result.error.name).toBe("ValidationError");
		}
	});
});
